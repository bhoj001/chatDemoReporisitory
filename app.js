var express = require('express'),	app = express(),	server = require('http').createServer(app),	io = require('socket.io').listen(server),	users={};	server.listen(3000);app.get('/', function(req, res){	res.sendFile(__dirname + '/index.html');});io.sockets.on('connection', function(socket){		socket.on('new user',function(data,callback){		if(socket.users){			callback(false);		}else{			callback(true);			socket.nickname=data;			users[socket.nickname]=socket;		updateNicknames();		}	});		function updateNicknames(){	io.sockets.emit('nicknames',Object.keys(users));			}			socket.on('send message', function(data,callback){		var msg = data.trim();		if(msg.substr(0,3)=="/w "){			msg = msg.substr(3);			var index = msg.indexOf(' ');//checking the index of next space...			if(index != -1){			//our whisper is working						//now check to see if the user exist in the array or not ...			var name = msg.substring(0,index);			var msg = msg.substring(index+1);//this stores the whispered message...						if(name in users){				users[name].emit('whisper', {msg:msg, nick:socket.nickname});				console.log("whispered msg");						}else{				callback('Error enter a valid user');			} 			}else{				//they didnt put any message in...				callback('Error please enter a message for your whisper.');			}				}else{		io.sockets.emit('new message', {msg:msg, nick:socket.nickname});		}				});	socket.on('disconnect', function(data){		if(!socket.nickname) return;		//nicknames.splice(nicknames.indexOf(socket.nickname), 1);		delete users[socket.nickname];		updateNicknames();	});	});